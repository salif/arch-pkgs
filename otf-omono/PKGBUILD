# Maintainer: Salif Mehmed <salifm@protonmail.com>

pkgname=otf-omono
pkgver=0.2020.0925
pkgrel=3
pkgdesc="OMono"
arch=("any")
url="https://example.com/"
license=("custom")
depends=("openssl" "sudo")
source=("${pkgname}.tar.gz::https://github.com/beichensky/Font/archive/782f5d9e797bb4be044702ccf8b4365de72f69af.tar.gz" "install.sh")
sha256sums=("c7eb24f046c7347323ab9d939a19e805038e3d5be73d10f4962f1aa00521048a" "2b6c6f127600e1635f3a37415cf37161daf621d2c5d63e97d9293aec89cf19d0")
install=omono.install

package() {
    install -d "$pkgdir"/usr/share/"$pkgname"/files
    install -m755 ./install.sh "$pkgdir"/usr/share/"$pkgname"/install.sh
    cd "Font-782f5d9e797bb4be044702ccf8b4365de72f69af"
    mkdir ./build
    cp ./*/*.otf ./build/
    cd ./build
    echo "Please write the BTW sentence:"
    read pp
    pp=$(echo -n "$pp" | tr '[:upper:]' '[:lower:]')
    for fin in *.otf; do
        nfin=$(echo -n "$fin" | openssl enc -aes-256-cbc -pbkdf2 -k "$pp" | openssl enc -A -base64 | tr '/' '-')
        openssl enc -aes-256-cbc -pbkdf2 -in ./"$fin" -out ./"$nfin" -k "$pp"
        rm ./"$fin"
    done

    install -m644 * "$pkgdir"/usr/share/"$pkgname"/files/
    echo -n "test" | openssl enc -aes-256-cbc -pbkdf2 -k "$pp" -out ./test.txt
    install -m644 ./test.txt "$pkgdir"/usr/share/"$pkgname"/test.txt
}
